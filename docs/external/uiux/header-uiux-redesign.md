# ヘッダー（Command Bar）整理 仕様・提案

作成日: 2025-12-26  
対象: `pdf-viewer` / `src/app/pages/viewer-shell/*`（主にヘッダー領域）  
関連:
- 全体UI方針: `docs/external/uiux/app-uiux-redesign.md`
- 複数PDF: `docs/design/multi-pdf-library-design.md`
- ページジャンプ: `docs/design/page-jump-design.md`
- オブジェクト出力: `docs/design/object-aware-download-design.md`

---

## 1. ゴール/非ゴール

### ゴール
- ヘッダーの情報と操作を **目的別に整理**し、「どこに何があるか」が直感的に分かる
- **常時表示の要素を減らす**（特に “重複表示” と “縦積み” を排除）ことで「ごちゃごちゃ感」を解消する
- `PDF未選択` / `処理中` / `Compare中` などの状態が **レイアウトを崩さず**に伝わる
- 既存要件（`一覧/前へ次へ/ページジャンプ/スライダー/ズーム/Objects/ダウンロード`）を満たす

### 非ゴール（この仕様書の範囲外）
- 注釈/検索/OCR/比較のUIそのものの作り直し（右ドック内の改善は別ドキュメント）
- アイコンセット導入（Material Icons 等）の選定・追加（※入れる場合は別途）

---

## 2. 現状の課題（観察）

現状の `viewer-shell__command-bar` は機能は揃っている一方、以下が “ごちゃごちゃ” に見える主因。

1) **重複表示**
- `Objects ON/OFF` が中央（ステータスピル）と右（ボタン）で二重に出ており、視線誘導が散る

2) **縦積み（スタック）で高さが増える**
- 右側が「ページ入力 + 移動 + スライダー」の縦積みになっており、ヘッダーが想定より“太く”見える

3) **操作の粒度・目的の混在**
- 「ファイル/ライブラリ操作」「ツール（検索/OCR/比較）」「閲覧（ページ/ズーム）」「出力」が同じ強さで並び、優先度が見えにくい

4) **状態表示がレイアウトに影響**
- ローディング/エラー/Compare表示などが増減するたびに、中央が詰まって見える（“常時の見た目” が安定しない）

---

## 3. 改修方針（Command Bar v2）

### 3.1 大原則
- **1行目は「主要操作」**、**2行目は「ページナビゲーション」** に役割分離する  
  → “縦積みの混在” を解消し、視線移動を短くする
- 常時表示は **主操作のみ**。頻度が低いものは **オーバーフロー（…メニュー）** へ退避する
- “状態表示” は **専用スロット**に集約し、増減しても周辺の配置を変えない

### 3.2 レイアウト（デスクトップ想定）

ワイヤー（例）:
```
┌──────────────────────────────────────────────────────────────────────────────┐
│ [PDFを追加] [ライブラリ] [前] [次] [検索] […ツール]   <docname…>   [status…]  │
│                                                                              │
│ p[ 12 ] / 120 ────────────────(slider)───────────────────────────  [-]100%[+]│
│                                                           [Objects] [DL]     │
└──────────────────────────────────────────────────────────────────────────────┘
```

#### 1行目（Primary Row）
- 左: **ファイル/ライブラリ**
  - `PDFを追加`（Primary）
  - `ライブラリ`（Left Dock を開く）
  - `前へ/次へ`（PDF切替。アイコン化/コンパクト化推奨）
- 中央: **ドキュメント名**
  - 1行固定・省略表示・tooltipでフル表示
- 右: **状態表示（固定枠）**
  - `Compare: ...` / `読み込み中...` / `OCR実行中...` / `ダウンロード中...` / `エラー` をここに集約
  - 表示が0件でも “空枠” を保持し、中央のドキュメント名が伸縮しすぎないようにする
- 1行目右端: **表示/出力**
  - `- 100% +` / `等倍`（必要なら等倍は “…” に退避可）
  - `Objects ON/OFF`（唯一のトグル表示）
  - `ダウンロード`

#### 2行目（Navigation Row）
- 左: `p{current}` 入力 + `/ {total}`
- 中央: ページスライダー（横幅を確保し、ページ移動に集中）
- 右: 余白（将来 `Prev/Next Page` を追加するならここ）

### 3.3 オーバーフロー（…ツール）
常時表示から退避する候補（頻度が低い/幅を取るもの）:
- `OCR`
- `比較`
- （将来）`設定/ショートカット一覧/ヘルプ` 等

要件上 `検索` は利用頻度が高い想定のため、原則は常時表示（ただし画面幅が狭い場合は退避してよい）。

---

## 4. UI仕様（表示・状態）

### 4.1 表示条件/disabled 条件（要点）
- `PDF未選択`（`!hasPdf()`）:
  - `ズーム/Objects/ダウンロード/ページ入力/スライダー` は disabled
  - 中央は `ファイル未選択` を表示
- `前へ/次へ`:
  - `!library.hasPrev()` / `!library.hasNext()` で disabled（現行踏襲）
- `Objects`:
  - `!flags.markers && !flags.comments` の場合は disabled（現行踏襲）
- `ダウンロード`:
  - `isDownloading()` 中は disabled（現行踏襲）

### 4.2 状態表示スロット（右側固定枠）
表示優先度（上から順）:
1. エラー（`pdf.lastError()`）
2. 処理中（`読み込み中` / `OCR 実行中` / `ダウンロード中`）
3. モード（`Compare` ON など）

表示は “チップ” を複数並べてもよいが、最大数を超える場合は `+N` に折りたたむ（MVPでは最大3まででも可）。

---

## 5. 操作仕様（振る舞い）

### 5.1 ページ入力/スライダー
詳細は `docs/design/page-jump-design.md` を踏襲する。
- 入力確定: `Enter` / `blur`（「移動」ボタンは2行目の簡素化のため **削除推奨**）
- スライダー:
  - `input`: 表示だけ更新
  - `change`: 実際にジャンプ

### 5.2 ツール（…メニュー）
- クリックでメニューを開く
- `OCR` / `比較` を選択すると、右ドックを開いて該当タブへ遷移
  - OCR: `rightDockTab='lists'`
  - Compare: `rightDockTab='compare'`
- `Esc` で閉じる

---

## 6. レスポンシブ仕様（最小限）

- `>= 1024px`:
  - 2行構成（Primary Row + Navigation Row）
  - 1行目は折り返し禁止（`flex-wrap: nowrap`）、溢れは “…” に退避
- `< 1024px`:
  - 既存の2段レイアウト方針に寄せる（`docs/external/uiux/app-uiux-redesign.md` と整合）
  - 2行目（Navigation Row）は表示維持（ページ移動が重要なため）
  - 画面幅がさらに狭い場合は `検索` も “…” に退避可

---

## 7. 実装メモ（ViewerShellComponent）

対象ファイル:
- `src/app/pages/viewer-shell/viewer-shell.component.html`
- `src/app/pages/viewer-shell/viewer-shell.component.scss`

実装ステップ（提案）:
1. `viewer-shell__command-bar` を 2行構成に変更
   - `Primary Row` と `Navigation Row` を新規DOM構造として分離
2. `Objects` の重複表示を解消
   - 中央のステータスピルから `Objects` を削除（または “表示のみ” にしてクリック不可にする）
3. `…ツール` メニューを追加し、`OCR/比較` を退避（MVP）
4. 「状態表示スロット」を右側に固定枠で設置し、ピル増減でレイアウトが暴れないようにする

---

## 8. 受け入れ条件（ヘッダー整理）

- `Objects` が **1箇所**の操作UIに統一されている
- デスクトップ幅でヘッダーが **意図せず縦に肥大化しない**（縦積み混在が無い）
- `PDF未選択/処理中/エラー` の表示でボタン群の位置が大きくズレない
- `ページ入力/スライダー` が常に見つけやすく、`Enter` とスライダーで問題なく移動できる
