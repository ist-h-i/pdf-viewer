## 目的
PDFビューアを「複数PDFを扱える」「操作が速い」「成果物（PDF）の再出力ができる」状態にする。

---

## 1. PDFのドラッグ&ドロップ取り込み
詳細設計: [drag-drop-import-design.md](../design/drag-drop-import-design.md)
### 概要
OSのファイル（PDF）をアプリ画面上にドラッグ&ドロップして読み込めるようにする。

### 想定UI/挙動
- ドロップ可能領域: アプリのビューア領域（可能なら画面全体）
- ドラッグ中: ドロップ領域のハイライト、カーソル表示（コピー）
- ドロップ時: PDFを読み込み、ビューアに表示する

### 入力仕様
- 受け付けるもの: `application/pdf`、拡張子`.pdf`
- 受け付けないもの: PDF以外（画像、zip等）
- 複数ファイルのドロップ: 仕様は「2. 複数PDFのアップロード」に従う（追加で読み込む）

### エラー/例外
- PDFとして読み込めない（破損、暗号化等）場合: トースト/ダイアログで理由を表示し、既存の表示は維持する
- 巨大ファイルで時間がかかる場合: ローディング表示を出す（キャンセル可）

### 受け入れ条件
- PDFをドロップすると表示が切り替わる（初回取り込みとして動作）
- PDF以外は取り込まれず、ユーザに分かる形で通知される

---

## 2. 複数PDFのアップロード（キュー/ライブラリ化）
詳細設計: [multi-pdf-library-design.md](../design/multi-pdf-library-design.md)
### 概要
アプリ内に複数PDFを読み込み、一覧から切り替えて閲覧できるようにする。

### 状態管理（最低限の要件）
- アプリ内で「読み込み済みPDFのリスト」を保持する
- 各PDFは一意に識別できる（例: 追加順インデックス、UUID）
- 「現在選択中のPDF」を保持する

### 追加（読み込み）ルール
- 追加方法: ファイル選択（既存機能があれば継続）/ドラッグ&ドロップ（1.）
- 追加時の挙動: リスト末尾に追加し、原則「追加したPDFを選択状態」にする
- 同一ファイル名の扱い: 許容（表示名は重複可）。必要なら「(2)」のように補助情報を付ける

### 2-1. ヘッダーに「一覧」ボタン + ダイアログでグリッド表示
#### UI
- ヘッダー右側（または既存の操作群の近く）に「一覧」ボタンを配置
- 押下でモーダルダイアログを開く
- ダイアログ内はPDFカードのグリッド（レスポンシブ）

#### カード表示内容（最低限）
- サムネイル（2-1-1）
- ファイル名（長い場合は省略表示、ツールチップで全文）
- ページ数（取得できる場合）
- 現在選択中のPDFは選択状態が視覚的に分かる（枠/チェック等）

#### 操作
- カードクリックでそのPDFに切り替え、ダイアログを閉じる
- ダイアログ外クリック/ESCで閉じる

#### 受け入れ条件
- 一覧から任意のPDFへ確実に切り替えられる
- 現在選択中が明確に分かる

### 2-1-1. PDFサムネイル表示
#### 要件
- 各PDFの「先頭ページ」をサムネイル化して表示する
- 読み込みが遅い場合はプレースホルダー（スケルトン）を表示する

#### 画質/サイズ
- 一覧で見分けが付く程度（例: 長辺150〜220px相当）
- 可能なら高DPI対応（canvasのスケーリング等）

#### キャッシュ
- 同一PDFを再度一覧表示したときに毎回生成しない（メモリキャッシュで可）

#### 失敗時
- サムネイル生成失敗は「アイコン+ファイル名」にフォールバックし、機能自体は使える

### 2-2. ヘッダーに「前へ/次へ」ボタンでPDF切り替え
#### UI
- ヘッダーに「前のPDF」「次のPDF」ボタンを配置
- 先頭/末尾のときは無効化する

#### 挙動
- 「前/次」で読み込み済みPDFリストの順序に従って切り替わる
- 切り替え時はビューアの状態をリセット

#### キーボード（任意）
- `Ctrl/Cmd + ←/→` 等で前後切り替え

---

## 3. オブジェクト状態の有無でPDFをダウンロード（再出力）
詳細設計: [object-aware-download-design.md](../design/object-aware-download-design.md)
### 概要
「オブジェクト（注釈/選択領域/ハイライト等）」がONの場合はその状態を反映したPDFをダウンロードできるようにする。
OFFの場合は「オブジェクトなしのPDF（原本相当）」をダウンロードできるようにする。

### 前提
- ここでいう「オブジェクト」は 選択範囲ハイライト、検索ワードハイライト、コメントボックス
- 「反映」とは、PDF annotationとして埋め込むことを示す

### UI
- ヘッダーに「ダウンロード」ボタン
- ダウンロード時のファイル名
  - 原本: `{ファイル名}.original.pdf`
  - オブジェクトあり: `{ファイル名}.annotated.pdf`

### 挙動
- 対象は「現在選択中のPDF」
- オブジェクトOFF: 原本（または原本相当）を出力する
- オブジェクトON: 現在のオブジェクト状態を反映したPDFを生成して出力する
- 生成に時間がかかる場合: 進捗/ローディング表示を出す

### 受け入れ条件
- ON/OFFで出力結果が変わることがユーザに確認できる
- ON時に「オブジェクトが含まれるPDF」が確実にダウンロードされ、Adobe Readerで開ける
- OFF時に「オブジェクトが含まれないPDF」が確実にダウンロードされる

---

## 4. ページ番号指定ジャンプ
詳細設計: [page-jump-design.md](../design/page-jump-design.md)
### 概要
ユーザがページ番号を指定して、そのページへ即座に移動できるようにする。

### UI
- ヘッダーにページ入力欄（例: `1 / 120`）を配置
- 送信方法: Enterキー、または「移動」ボタン
- 現在ページはスクロール/表示に追従して更新される
- ページング用にスライダーを配置

### 入力仕様
- 1始まりのページ番号
- 受け付ける入力: 数値（全角は半角に正規化できると良い）
- 範囲外:
  - `0`以下 → 1へ丸める
  - 最大ページ超え → 最大ページへ丸める
- 空/非数:
  - 入力を元に戻す

### 挙動
- ジャンプ実行後、該当ページがビューア中央（または先頭）に来るようスクロール/表示を更新する
- PDF切り替え（2.）時はページ入力欄も切り替わる（ページ数、現在ページ）

### 受け入れ条件
- 任意ページに数秒以内でジャンプできる（極端に重いPDFは除く）
- 不正入力時に破綻せず、ユーザに分かるフィードバックがある
