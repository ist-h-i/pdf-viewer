# 要件定義（pdf-viewer）

## 1. 概要
本プロジェクトは、ブラウザ上でローカルの PDF を読み込み・表示し、検索/ハイライト/コメント/OCR(擬似)/PDF 比較などを行うための Angular アプリです。

## 2. 目的
- ローカル PDF を手早く確認できること
- PDF 内テキストの検索と、該当箇所の視覚的な強調表示ができること
- 簡易的な注釈（ハイライト、コメント）を付与して確認作業を支援すること
- 2 つの PDF の差分（テキストベース）を把握できること

## 3. 前提/制約
- PDF の読み込み/レンダリングはブラウザ環境でのみ提供する（SSR 実行時は利用不可）。
- PDF はファイルピッカーから読み込み、サーバへアップロードしない（メモリ上で扱う）。
- PDF.js の worker はローカル配信する（例: `public/assets/pdf.worker.min.mjs` をビルド時に配布）。

## 4. 対象ユーザー
- 手元の PDF を閲覧・検索し、簡易メモ（コメント/ハイライト）を付けたいユーザー
- 版違い PDF の差分（ページ単位のテキスト差分）を概観したいユーザー

## 5. スコープ
### 5.1 対象範囲（In scope）
- PDF の読み込み、ページ表示
- 表示倍率変更（ズームイン/アウト/リセット）
- 表示中 PDF のダウンロード
- 全文検索（ページ横断）と検索結果一覧表示
- ハイライト（検索結果・選択テキスト）
- コメント（ボックスとコメント対象を示す棒線、棒線の片方はボックスに固定）追加/表示/移動/削除、コメントスレッド（返信追加）
- OCR/テキスト抽出
- PDF 比較（画面を左右分割して比較表示、差分をハイライト）
- 機能フラグによる各機能の ON/OFF

### 5.2 対象外（Out of scope）
- PDF そのものの編集（ページ削除、追記、置換等）
- 注釈（コメント/ハイライト）の永続化（保存/読み込み、エクスポート）
- 画像ベースの差分可視化（ピクセル比較）

## 6. 機能要件
### FR-01: PDF 読み込み
- ファイルピッカーから `application/pdf` を選択して読み込めること。
- 読み込み中/エラー状態を UI 上で確認できること。

### FR-02: PDF 表示
- PDF をページ単位で縦スクロール表示できること。
- ページ数と現在のファイル名を表示できること。

### FR-03: ズーム
- ズームイン/アウト/リセットができること。
- ズーム変更後にページ表示（および注釈レイヤー）を破綻なく更新できること。

### FR-04: ダウンロード
- 読み込んだ PDF をダウンロードできること（元ファイル名を優先）。

### FR-05: 検索
- キーワードで全文検索できること（ページ横断）。
- 検索結果（ページ番号 + 周辺文脈）を一覧表示できること。
- 検索ヒット箇所をハイライト表示できること。
- 検索結果をクリアできること。

### FR-06: ハイライト（選択テキスト）
- ページ上でテキストを選択し、コンテキストメニューからハイライトを追加できること。
- 追加したハイライトはページ上に重ねて表示されること。

### FR-07: コメント
- ページ上の任意位置にコメントを追加できること（コンテキストメニュー）。
- コメントはページ上に吹き出し/コールアウトとして表示されること。
- コメントをドラッグで移動できること。
- コメントの吹き出しサイズやポインター位置を調整できること。
- コメント一覧パネルからコメントの閲覧、返信追加、削除ができること。

### FR-08: OCR/テキスト抽出（擬似）
- ページ番号を指定して処理を実行できること。
- 抽出テキストと処理時間を表示できること。

### FR-09: PDF 比較（テキストベース）
- 比較対象 PDF を選択して比較できること。
- 追加/削除ページ数、差分ページ番号の一覧、および簡易メモを表示できること。

### FR-10: 機能フラグ
- 検索/マーカー/コメント/OCR/比較を個別に有効/無効化できること（ビルド/実行時の DI 設定で切替可能）。

## 7. 非機能要件
### NFR-01: 対応環境
- 最新版の Chromium 系ブラウザ（Chrome/Edge）で動作することを前提とする。

### NFR-02: セキュリティ/プライバシー
- PDF ファイルはブラウザ内で処理し、外部送信しないこと。
- 想定外入力（壊れた PDF 等）でアプリが致命的に破綻しないこと（エラー表示）。

### NFR-03: 性能
- 中規模 PDF の閲覧/検索が実用的な待ち時間で完了すること（ページ数に応じて段階的に表示更新されること）。

## 8. 受け入れ条件（例）
- PDF を選択するとページが表示され、ページ数/ファイル名が確認できる
- ズーム操作で表示倍率が変わり、表示崩れや操作不能が起きない
- 検索で結果が一覧表示され、クリックで該当ページへ移動できる
- 右クリックからコメント追加/ハイライト追加ができる
- 比較 PDF を選択すると差分サマリが表示される

